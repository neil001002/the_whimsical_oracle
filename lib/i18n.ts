import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import { Platform } from 'react-native';
import * as Localization from 'expo-localization';
import LanguageDetector from 'i18next-browser-languagedetector';

// Enhanced translation resources with oracle-specific content
const resources = {
  en: {
    translation: {
      common: {
        close: 'Close',
        cancel: 'Cancel',
        confirm: 'Confirm',
        save: 'Save',
        loading: 'Loading...',
        error: 'Error',
        success: 'Success',
        retry: 'Retry',
      },
      home: {
        title: 'The Whimsical Oracle',
        subtitle: 'Where cosmic wisdom meets earthly guidance',
        greeting: {
          morning: 'Good Morning, Seeker',
          afternoon: 'Good Afternoon, Traveler',
          evening: 'Good Evening, Mystic',
        },
        dailyReadings: {
          title: 'Daily Mystical Readings',
          limitReached: 'Daily limit reached. Upgrade for unlimited mystical guidance!',
        },
        subscriptionBanner: {
          message: 'Unlock unlimited mystical wisdom and premium features!',
        },
        notifications: {
          limitReached: {
            title: '‚ú® Mystical Limit Reached',
            message: 'You\'ve reached your daily reading limit. Upgrade to Premium for unlimited cosmic guidance and enhanced mystical features!',
            action: 'Unlock Mystical Powers',
          },
          voiceWarning: {
            title: 'Voice Features Limited',
            message: 'Voice features are not fully available on this platform. For complete mystical voice functionality, use a custom development build.',
          },
          videoError: {
            title: 'Video Oracle Issue',
          },
        },
        persona: {
          mystic: 'MYSTIC',
        },
        videoOracle: {
          title: 'Video Oracle Session',
          start: 'Video Oracle',
          end: 'End Video',
        },
        omen: {
          guidance: 'Mystical Guidance',
          resonance: 'Cosmic Resonance',
          category: 'Category',
          speaking: 'üéµ Oracle speaking mystical wisdom...',
        },
        oracle: {
          awaits: 'The Oracle Awaits...',
          instruction: 'Touch the mystical crystal to receive your cosmic guidance',
          generating: 'Consulting the Cosmic Forces...',
          receive: 'Receive Oracle',
        },
        upgrade: {
          text: 'Unlock unlimited mystical wisdom',
          accessibility: 'Unlock unlimited mystical wisdom',
        },
      },
      oracle: {
        phrases: {
          basic: {
            1: 'The digital ravens whisper of unexpected connections',
            2: 'Silver threads weave through the fabric of tomorrow',
            3: 'Ancient wisdom flows through modern channels',
            4: 'The cosmic dance reveals hidden patterns',
            5: 'Stars align to illuminate forgotten paths',
          },
          premium: {
            1: 'The cosmic symphony resonates with your soul\'s deepest yearnings',
            2: 'Ethereal guardians dance around the threads of your destiny',
            3: 'The universe conspires to unveil the sacred mysteries within',
            4: 'Celestial energies align to illuminate your path forward',
            5: 'The ancient ones speak through the veil of time and space',
            6: 'Stardust memories awaken the dormant magic in your heart',
            7: 'The celestial tapestry weaves new possibilities into existence',
            8: 'Divine frequencies harmonize with your spiritual essence',
          },
        },
        interpretations: {
          basic: {
            1: 'A message from beyond the veil suggests transformation approaches',
            2: 'The universe conspires to bring clarity to confusion',
            3: 'Hidden opportunities emerge from unexpected places',
            4: 'Past wisdom illuminates present challenges',
            5: 'New beginnings await those who trust the process',
          },
          premium: {
            1: 'The cosmic forces have aligned to reveal a profound truth about your journey',
            2: 'Your spiritual guides are orchestrating synchronicities to guide your path',
            3: 'The universe is preparing to bestow upon you a gift of divine insight',
            4: 'Ancient wisdom keepers are opening doorways to new possibilities',
            5: 'The celestial realm is weaving magic into your earthly experience',
            6: 'Sacred geometry patterns are manifesting in your reality',
            7: 'The quantum field responds to your elevated consciousness',
            8: 'Multidimensional energies converge to support your highest good',
          },
        },
        advice: {
          basic: {
            1: 'Trust your intuition and take the first step forward',
            2: 'Pay attention to synchronicities appearing in your life',
            3: 'Release what no longer serves your highest good',
            4: 'Embrace change as the universe\'s gift to your growth',
            5: 'Connect with others who share your mystical journey',
          },
          premium: {
            1: 'Embrace the sacred dance between surrender and intentional action',
            2: 'Allow your heart\'s wisdom to guide you through this mystical transformation',
            3: 'Trust in the divine timing of the universe\'s grand design for your life',
            4: 'Open yourself to receive the abundant blessings flowing toward you',
            5: 'Step boldly into your power as a co-creator with the cosmic forces',
            6: 'Activate your inner oracle through meditation and sacred rituals',
            7: 'Channel the celestial energies into manifestation of your dreams',
            8: 'Align with the cosmic currents that carry you toward your destiny',
          },
        },
      },
      categories: {
        career: 'Career',
        relationships: 'Relationships',
        health: 'Health',
        creativity: 'Creativity',
        finance: 'Finance',
        growth: 'Growth',
      },
      settings: {
        title: 'Mystical Settings',
        subtitle: 'Configure your oracle experience',
        sections: {
          language: {
            title: 'Language',
            subtitle: 'Choose your mystical language',
          },
          persona: {
            title: 'Oracle Persona',
            subtitle: 'Choose your mystical guide',
          },
          voice: {
            title: 'Voice & Communication',
            voiceNarration: {
              title: 'Voice Narration',
              subtitle: 'Spoken oracle wisdom',
            },
            realTimeChat: {
              title: 'Real-time Voice Chat',
              subtitle: 'Interactive voice conversations',
            },
            serviceStatus: 'Voice Service Status:',
            liveKitStatus: 'LiveKit Voice Chat:',
            ttsStatus: 'Voice TTS:',
            available: 'Available',
            requiresCustomBuild: 'Requires Custom Build',
            limited: 'Limited',
            testVoice: 'Test Voice',
            stopVoice: 'Stop Voice Test',
            testNote: 'Test how your selected oracle sounds',
            connectVoiceChat: 'Connect Voice Chat',
            disconnectVoiceChat: 'Disconnect Voice Chat',
            voiceChatConnected: 'üéôÔ∏è Voice chat connected',
            warning: '‚ö†Ô∏è Voice chat requires a custom development build with WebRTC support. Currently using Web Speech API for basic voice features.',
            testMessage: 'Greetings, seeker. This is how {{persona}} sounds when speaking mystical wisdom.',
          },
          preferences: {
            title: 'Mystical Preferences',
            soundEffects: {
              title: 'Sound Effects',
              subtitle: 'Mystical audio feedback',
            },
            hapticFeedback: {
              title: 'Haptic Feedback',
              subtitle: 'Tactile mystical sensations',
            },
          },
          subscription: {
            title: 'Subscription Status',
            description: {
              free: 'Access to basic oracle features',
              premium: 'Full access to all mystical powers',
            },
            upgrade: 'Unlock Mystical Powers',
          },
        },
      },
      personas: {
        'cosmic-sage': {
          name: 'Cosmic Sage',
          description: 'Ancient wisdom from the stars, speaking in cosmic metaphors',
        },
        'mystical-librarian': {
          name: 'Mystical Librarian',
          description: 'Bookish wisdom keeper with literary enchantments',
        },
        'starlight-fairy': {
          name: 'Starlight Fairy',
          description: 'Playful forest spirit bringing nature-focused wisdom',
        },
        'crystal-prophet': {
          name: 'Crystal Prophet',
          description: 'Mysterious seer channeling gemstone energies',
        },
        'time-weaver': {
          name: 'Time Weaver',
          description: 'Temporal guardian connecting past, present, and future',
        },
      },
      history: {
        title: 'Omen Chronicle',
        subtitle: 'Your mystical journey through time',
        empty: {
          title: 'No Omens Yet',
          subtitle: 'Visit the Oracle to receive your first mystical guidance',
        },
      },
      premium: {
        title: 'Unlock Mystical Powers',
        subtitle: 'Choose your path to deeper wisdom',
        currentPlan: 'Current Plan',
        features: {
          unlimited: 'Unlimited oracle readings',
          personas: 'All mystical personas',
          voice: 'Enhanced voice features',
          history: 'Complete reading history',
          support: 'Premium support',
        },
      },
      profile: {
        title: 'Mystical Profile',
        subtitle: 'Your journey through the cosmic realm',
        stats: {
          totalReadings: 'Total Readings',
          averageRating: 'Avg Rating',
          dayStreak: 'Day Streak',
          favoriteCategory: 'Favorite Topic',
        },
        achievements: {
          title: 'Mystical Achievements',
          firstSteps: 'First Steps',
          seeker: 'Seeker',
          explorer: 'Mystic Explorer',
          appreciator: 'Wisdom Appreciator',
        },
      },
    },
  },
  es: {
    translation: {
      common: {
        close: 'Cerrar',
        cancel: 'Cancelar',
        confirm: 'Confirmar',
        save: 'Guardar',
        loading: 'Cargando...',
        error: 'Error',
        success: '√âxito',
        retry: 'Reintentar',
      },
      home: {
        title: 'El Or√°culo Caprichoso',
        subtitle: 'Donde la sabidur√≠a c√≥smica se encuentra con la gu√≠a terrenal',
        greeting: {
          morning: 'Buenos D√≠as, Buscador',
          afternoon: 'Buenas Tardes, Viajero',
          evening: 'Buenas Noches, M√≠stico',
        },
        dailyReadings: {
          title: 'Lecturas M√≠sticas Diarias',
          limitReached: 'L√≠mite diario alcanzado. ¬°Actualiza para gu√≠a m√≠stica ilimitada!',
        },
        subscriptionBanner: {
          message: '¬°Desbloquea sabidur√≠a m√≠stica ilimitada y funciones premium!',
        },
        notifications: {
          limitReached: {
            title: '‚ú® L√≠mite M√≠stico Alcanzado',
            message: '¬°Has alcanzado tu l√≠mite de lecturas diarias. Actualiza a Premium para gu√≠a c√≥smica ilimitada y funciones m√≠sticas mejoradas!',
            action: 'Desbloquear Poderes M√≠sticos',
          },
          voiceWarning: {
            title: 'Funciones de Voz Limitadas',
            message: 'Las funciones de voz no est√°n completamente disponibles en esta plataforma. Para funcionalidad de voz m√≠stica completa, usa una compilaci√≥n de desarrollo personalizada.',
          },
          videoError: {
            title: 'Problema del Or√°culo de Video',
          },
        },
        persona: {
          mystic: 'M√çSTICO',
        },
        videoOracle: {
          title: 'Sesi√≥n del Or√°culo de Video',
          start: 'Or√°culo de Video',
          end: 'Terminar Video',
        },
        omen: {
          guidance: 'Gu√≠a M√≠stica',
          resonance: 'Resonancia C√≥smica',
          category: 'Categor√≠a',
          speaking: 'üéµ Or√°culo hablando sabidur√≠a m√≠stica...',
        },
        oracle: {
          awaits: 'El Or√°culo Espera...',
          instruction: 'Toca el cristal m√≠stico para recibir tu gu√≠a c√≥smica',
          generating: 'Consultando las Fuerzas C√≥smicas...',
          receive: 'Recibir Or√°culo',
        },
        upgrade: {
          text: 'Desbloquear sabidur√≠a m√≠stica ilimitada',
          accessibility: 'Desbloquear sabidur√≠a m√≠stica ilimitada',
        },
      },
      oracle: {
        phrases: {
          basic: {
            1: 'Los cuervos digitales susurran de conexiones inesperadas',
            2: 'Hilos plateados se tejen a trav√©s del tejido del ma√±ana',
            3: 'La sabidur√≠a antigua fluye a trav√©s de canales modernos',
            4: 'La danza c√≥smica revela patrones ocultos',
            5: 'Las estrellas se alinean para iluminar senderos olvidados',
          },
          premium: {
            1: 'La sinfon√≠a c√≥smica resuena con los anhelos m√°s profundos de tu alma',
            2: 'Guardianes et√©reos danzan alrededor de los hilos de tu destino',
            3: 'El universo conspira para revelar los misterios sagrados dentro',
            4: 'Las energ√≠as celestiales se alinean para iluminar tu camino hacia adelante',
            5: 'Los antiguos hablan a trav√©s del velo del tiempo y el espacio',
            6: 'Los recuerdos de polvo de estrellas despiertan la magia latente en tu coraz√≥n',
            7: 'El tapiz celestial teje nuevas posibilidades en la existencia',
            8: 'Las frecuencias divinas armonizan con tu esencia espiritual',
          },
        },
        interpretations: {
          basic: {
            1: 'Un mensaje desde m√°s all√° del velo sugiere que se acerca la transformaci√≥n',
            2: 'El universo conspira para traer claridad a la confusi√≥n',
            3: 'Las oportunidades ocultas emergen de lugares inesperados',
            4: 'La sabidur√≠a pasada ilumina los desaf√≠os presentes',
            5: 'Nuevos comienzos esperan a aquellos que conf√≠an en el proceso',
          },
          premium: {
            1: 'Las fuerzas c√≥smicas se han alineado para revelar una verdad profunda sobre tu viaje',
            2: 'Tus gu√≠as espirituales est√°n orquestando sincronicidades para guiar tu camino',
            3: 'El universo se prepara para otorgarte un regalo de perspicacia divina',
            4: 'Los guardianes de la sabidur√≠a antigua est√°n abriendo puertas a nuevas posibilidades',
            5: 'El reino celestial est√° tejiendo magia en tu experiencia terrenal',
            6: 'Los patrones de geometr√≠a sagrada se manifiestan en tu realidad',
            7: 'El campo cu√°ntico responde a tu conciencia elevada',
            8: 'Las energ√≠as multidimensionales convergen para apoyar tu mayor bien',
          },
        },
        advice: {
          basic: {
            1: 'Conf√≠a en tu intuici√≥n y da el primer paso hacia adelante',
            2: 'Presta atenci√≥n a las sincronicidades que aparecen en tu vida',
            3: 'Libera lo que ya no sirve a tu mayor bien',
            4: 'Abraza el cambio como el regalo del universo para tu crecimiento',
            5: 'Con√©ctate con otros que comparten tu viaje m√≠stico',
          },
          premium: {
            1: 'Abraza la danza sagrada entre la rendici√≥n y la acci√≥n intencional',
            2: 'Permite que la sabidur√≠a de tu coraz√≥n te gu√≠e a trav√©s de esta transformaci√≥n m√≠stica',
            3: 'Conf√≠a en el tiempo divino del gran dise√±o del universo para tu vida',
            4: '√Åbrete para recibir las bendiciones abundantes que fluyen hacia ti',
            5: 'Entra audazmente en tu poder como co-creador con las fuerzas c√≥smicas',
            6: 'Activa tu or√°culo interior a trav√©s de la meditaci√≥n y rituales sagrados',
            7: 'Canaliza las energ√≠as celestiales en la manifestaci√≥n de tus sue√±os',
            8: 'Alin√©ate con las corrientes c√≥smicas que te llevan hacia tu destino',
          },
        },
      },
      categories: {
        career: 'Carrera',
        relationships: 'Relaciones',
        health: 'Salud',
        creativity: 'Creatividad',
        finance: 'Finanzas',
        growth: 'Crecimiento',
      },
      settings: {
        title: 'Configuraci√≥n M√≠stica',
        subtitle: 'Configura tu experiencia del or√°culo',
        sections: {
          language: {
            title: 'Idioma',
            subtitle: 'Elige tu idioma m√≠stico',
          },
          persona: {
            title: 'Persona del Or√°culo',
            subtitle: 'Elige tu gu√≠a m√≠stico',
          },
          voice: {
            title: 'Voz y Comunicaci√≥n',
            voiceNarration: {
              title: 'Narraci√≥n de Voz',
              subtitle: 'Sabidur√≠a del or√°culo hablada',
            },
            realTimeChat: {
              title: 'Chat de Voz en Tiempo Real',
              subtitle: 'Conversaciones de voz interactivas',
            },
            serviceStatus: 'Estado del Servicio de Voz:',
            liveKitStatus: 'Chat de Voz LiveKit:',
            ttsStatus: 'TTS de Voz:',
            available: 'Disponible',
            requiresCustomBuild: 'Requiere Compilaci√≥n Personalizada',
            limited: 'Limitado',
            testVoice: 'Probar Voz',
            stopVoice: 'Detener Prueba de Voz',
            testNote: 'Prueba c√≥mo suena tu or√°culo seleccionado',
            connectVoiceChat: 'Conectar Chat de Voz',
            disconnectVoiceChat: 'Desconectar Chat de Voz',
            voiceChatConnected: 'üéôÔ∏è Chat de voz conectado',
            warning: '‚ö†Ô∏è El chat de voz requiere una compilaci√≥n de desarrollo personalizada con soporte WebRTC. Actualmente usando Web Speech API para funciones b√°sicas de voz.',
            testMessage: 'Saludos, buscador. As√≠ es como suena {{persona}} al hablar sabidur√≠a m√≠stica.',
          },
          preferences: {
            title: 'Preferencias M√≠sticas',
            soundEffects: {
              title: 'Efectos de Sonido',
              subtitle: 'Retroalimentaci√≥n de audio m√≠stico',
            },
            hapticFeedback: {
              title: 'Retroalimentaci√≥n H√°ptica',
              subtitle: 'Sensaciones m√≠sticas t√°ctiles',
            },
          },
          subscription: {
            title: 'Estado de Suscripci√≥n',
            description: {
              free: 'Acceso a funciones b√°sicas del or√°culo',
              premium: 'Acceso completo a todos los poderes m√≠sticos',
            },
            upgrade: 'Desbloquear Poderes M√≠sticos',
          },
        },
      },
      personas: {
        'cosmic-sage': {
          name: 'Sabio C√≥smico',
          description: 'Sabidur√≠a antigua de las estrellas, hablando en met√°foras c√≥smicas',
        },
        'mystical-librarian': {
          name: 'Bibliotecario M√≠stico',
          description: 'Guardi√°n de sabidur√≠a libresca con encantamientos literarios',
        },
        'starlight-fairy': {
          name: 'Hada de Luz Estelar',
          description: 'Esp√≠ritu del bosque juguet√≥n que trae sabidur√≠a centrada en la naturaleza',
        },
        'crystal-prophet': {
          name: 'Profeta de Cristal',
          description: 'Vidente misterioso canalizando energ√≠as de gemas',
        },
        'time-weaver': {
          name: 'Tejedor del Tiempo',
          description: 'Guardi√°n temporal conectando pasado, presente y futuro',
        },
      },
      history: {
        title: 'Cr√≥nica de Presagios',
        subtitle: 'Tu viaje m√≠stico a trav√©s del tiempo',
        empty: {
          title: 'A√∫n No Hay Presagios',
          subtitle: 'Visita el Or√°culo para recibir tu primera gu√≠a m√≠stica',
        },
      },
      premium: {
        title: 'Desbloquear Poderes M√≠sticos',
        subtitle: 'Elige tu camino hacia una sabidur√≠a m√°s profunda',
        currentPlan: 'Plan Actual',
        features: {
          unlimited: 'Lecturas de or√°culo ilimitadas',
          personas: 'Todas las personas m√≠sticas',
          voice: 'Funciones de voz mejoradas',
          history: 'Historial completo de lecturas',
          support: 'Soporte premium',
        },
      },
      profile: {
        title: 'Perfil M√≠stico',
        subtitle: 'Tu viaje a trav√©s del reino c√≥smico',
        stats: {
          totalReadings: 'Lecturas Totales',
          averageRating: 'Calificaci√≥n Promedio',
          dayStreak: 'Racha de D√≠as',
          favoriteCategory: 'Tema Favorito',
        },
        achievements: {
          title: 'Logros M√≠sticos',
          firstSteps: 'Primeros Pasos',
          seeker: 'Buscador',
          explorer: 'Explorador M√≠stico',
          appreciator: 'Apreciador de Sabidur√≠a',
        },
      },
    },
  },
  fr: {
    translation: {
      common: {
        close: 'Fermer',
        cancel: 'Annuler',
        confirm: 'Confirmer',
        save: 'Sauvegarder',
        loading: 'Chargement...',
        error: 'Erreur',
        success: 'Succ√®s',
        retry: 'R√©essayer',
      },
      home: {
        title: 'L\'Oracle Fantaisiste',
        subtitle: 'O√π la sagesse cosmique rencontre la guidance terrestre',
        greeting: {
          morning: 'Bonjour, Chercheur',
          afternoon: 'Bon Apr√®s-midi, Voyageur',
          evening: 'Bonsoir, Mystique',
        },
        dailyReadings: {
          title: 'Lectures Mystiques Quotidiennes',
          limitReached: 'Limite quotidienne atteinte. Mettez √† niveau pour une guidance mystique illimit√©e!',
        },
        subscriptionBanner: {
          message: 'D√©bloquez une sagesse mystique illimit√©e et des fonctionnalit√©s premium!',
        },
        notifications: {
          limitReached: {
            title: '‚ú® Limite Mystique Atteinte',
            message: 'Vous avez atteint votre limite de lectures quotidiennes. Passez √† Premium pour une guidance cosmique illimit√©e et des fonctionnalit√©s mystiques am√©lior√©es!',
            action: 'D√©bloquer les Pouvoirs Mystiques',
          },
          voiceWarning: {
            title: 'Fonctionnalit√©s Vocales Limit√©es',
            message: 'Les fonctionnalit√©s vocales ne sont pas enti√®rement disponibles sur cette plateforme. Pour une fonctionnalit√© vocale mystique compl√®te, utilisez une compilation de d√©veloppement personnalis√©e.',
          },
          videoError: {
            title: 'Probl√®me de l\'Oracle Vid√©o',
          },
        },
        persona: {
          mystic: 'MYSTIQUE',
        },
        videoOracle: {
          title: 'Session de l\'Oracle Vid√©o',
          start: 'Oracle Vid√©o',
          end: 'Terminer Vid√©o',
        },
        omen: {
          guidance: 'Guidance Mystique',
          resonance: 'R√©sonance Cosmique',
          category: 'Cat√©gorie',
          speaking: 'üéµ Oracle parlant de sagesse mystique...',
        },
        oracle: {
          awaits: 'L\'Oracle Attend...',
          instruction: 'Touchez le cristal mystique pour recevoir votre guidance cosmique',
          generating: 'Consultation des Forces Cosmiques...',
          receive: 'Recevoir Oracle',
        },
        upgrade: {
          text: 'D√©bloquer une sagesse mystique illimit√©e',
          accessibility: 'D√©bloquer une sagesse mystique illimit√©e',
        },
      },
      // Add more French translations as needed...
      categories: {
        career: 'Carri√®re',
        relationships: 'Relations',
        health: 'Sant√©',
        creativity: 'Cr√©ativit√©',
        finance: 'Finance',
        growth: 'Croissance',
      },
      personas: {
        'cosmic-sage': {
          name: 'Sage Cosmique',
          description: 'Sagesse ancienne des √©toiles, parlant en m√©taphores cosmiques',
        },
        'mystical-librarian': {
          name: 'Biblioth√©caire Mystique',
          description: 'Gardien de sagesse livresque avec des enchantements litt√©raires',
        },
        'starlight-fairy': {
          name: 'F√©e de Lumi√®re Stellaire',
          description: 'Esprit de for√™t enjou√© apportant une sagesse centr√©e sur la nature',
        },
        'crystal-prophet': {
          name: 'Proph√®te de Cristal',
          description: 'Voyant myst√©rieux canalisant les √©nergies des gemmes',
        },
        'time-weaver': {
          name: 'Tisseur du Temps',
          description: 'Gardien temporel connectant pass√©, pr√©sent et futur',
        },
      },
    },
  },
};

// Supported languages configuration
export const SUPPORTED_LANGUAGES = [
  { code: 'en', name: 'English', nativeName: 'English', flag: 'üá∫üá∏' },
  { code: 'es', name: 'Spanish', nativeName: 'Espa√±ol', flag: 'üá™üá∏' },
  { code: 'fr', name: 'French', nativeName: 'Fran√ßais', flag: 'üá´üá∑' },
  { code: 'de', name: 'German', nativeName: 'Deutsch', flag: 'üá©üá™' },
  { code: 'it', name: 'Italian', nativeName: 'Italiano', flag: 'üáÆüáπ' },
  { code: 'pt', name: 'Portuguese', nativeName: 'Portugu√™s', flag: 'üáµüáπ' },
  { code: 'ja', name: 'Japanese', nativeName: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ' },
  { code: 'ko', name: 'Korean', nativeName: 'ÌïúÍµ≠Ïñ¥', flag: 'üá∞üá∑' },
  { code: 'zh', name: 'Chinese', nativeName: '‰∏≠Êñá', flag: 'üá®üá≥' },
  { code: 'ar', name: 'Arabic', nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', flag: 'üá∏üá¶' },
  { code: 'hi', name: 'Hindi', nativeName: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', flag: 'üáÆüá≥' },
  { code: 'ru', name: 'Russian', nativeName: '–†—É—Å—Å–∫–∏–π', flag: 'üá∑üá∫' },
];

// RTL languages
export const RTL_LANGUAGES = ['ar'];

// Helper function to check if language is RTL
export const isRTL = (languageCode: string): boolean => {
  return RTL_LANGUAGES.includes(languageCode);
};

// Detect device locale
const getDeviceLocale = (): string => {
  try {
    const locales = Localization.getLocales();
    const deviceLanguage = locales[0]?.languageCode || 'en';
    
    // Check if we support this language
    const supportedLanguages = SUPPORTED_LANGUAGES.map(lang => lang.code);
    return supportedLanguages.includes(deviceLanguage) ? deviceLanguage : 'en';
  } catch (error) {
    console.warn('Failed to get device locale:', error);
    return 'en';
  }
};

// Storage helpers
const LANGUAGE_STORAGE_KEY = 'whimsical-oracle-language';

export const getStoredLanguage = (): string | null => {
  if (Platform.OS === 'web' && typeof window !== 'undefined' && typeof window.localStorage !== 'undefined') {
    try {
      return window.localStorage.getItem(LANGUAGE_STORAGE_KEY);
    } catch (error) {
      console.warn('Failed to get stored language:', error);
      return null;
    }
  }
  // For mobile, you would use AsyncStorage here
  return null;
};

export const setStoredLanguage = (locale: string): void => {
  if (Platform.OS === 'web' && typeof window !== 'undefined' && typeof window.localStorage !== 'undefined') {
    try {
      window.localStorage.setItem(LANGUAGE_STORAGE_KEY, locale);
    } catch (error) {
      console.warn('Failed to store language:', error);
    }
  }
  // For mobile, you would use AsyncStorage here
};

// Initialize i18next
const initI18n = () => {
  const storedLanguage = getStoredLanguage();
  const deviceLanguage = getDeviceLocale();
  const initialLanguage = storedLanguage || deviceLanguage;

  let i18nInstance = i18n;

  // Only use LanguageDetector on web
  if (Platform.OS === 'web') {
    i18nInstance = i18n.use(LanguageDetector);
  }

  i18nInstance
    .use(initReactI18next)
    .init({
      resources,
      lng: initialLanguage,
      fallbackLng: 'en',
      debug: __DEV__,
      
      interpolation: {
        escapeValue: false,
      },

      detection: Platform.OS === 'web' ? {
        order: ['localStorage', 'navigator'],
        caches: ['localStorage'],
        lookupLocalStorage: LANGUAGE_STORAGE_KEY,
      } : undefined,

      react: {
        useSuspense: false,
      },
    });

  return i18n;
};

// Initialize and export
const i18nInstance = initI18n();

export default i18nInstance;

// Export convenience functions
export const t = (key: string, fallback?: string, params?: Record<string, any>): string => {
  const translation = i18nInstance.t(key, params);
  // If translation equals the key, it means no translation was found
  if (translation === key && fallback) {
    return fallback;
  }
  return translation;
};

export const getCurrentLanguage = (): string => {
  return i18nInstance.language;
};

export const changeLanguage = async (locale: string): Promise<void> => {
  await i18nInstance.changeLanguage(locale);
  setStoredLanguage(locale);
};